router:
  -
    name: http-router_80
    driver: http  # http驱动
    listen: 80    # 监听端口
    host:       # 域名列表，满足该监听端口且域名在下列列表中的可进入该路由
      - open.*.eolinker.com
        www.apibee.com
        www.apishop.net
    rules:      # 规则列表
      - location: "/abc"
        header:
          version: 1.0
          app: goku
      - location: "/"
        header:
          user: abc
          token: abc
    target: login1@service
  -
    name: https-router_443
    driver: http
    listen: 443
    cert:
      -
        key: apibee.key
        crt: apibee.crt
      -
        key: eolinker.key
        crt: eolinker.crt
    host:
      - www.eolinker.com
        www.apibee.com
        www.apishop.net
    rules:
      - location: "/"
        header:
          version: 1.0
          app: goku
      - location: "/"
        header:
          user: abc
          token: abc
    target: guest@service
service:
  -
    name: guest
    driver: http
    desc: "游客服务"
    timeout: 30000
    upstream: product-user@upstream
    retry: 2
    rewrite_url: /abc
    auth:
      - basic_1
      - ak/sk_1
      - apikey_1
  -
    name: member
    driver: http
    desc: "会员服务"
    timeout: 30000
    retry: 2
    upstream: test-user@upstream
    rewrite_url: /abc
  -
    name: anonymous
    driver: http
    desc: "匿名访问"
    timeout: 3000
    upstream: www.eolinker.com
    rewrite_url: /
    retry: 2
    scheme: http

upstream:
  -
    name: product-user
    driver: http_proxy  # 静态负载
    desc: "生产环境-用户模块"
    discovery: static_1@discovery
    config: 10.1.1.1 weight=1000;10.1.1.2 weight=10
    scheme: http
    type: round-robin

  -
    name: test-user
    driver: http_proxy
    discovery: static_1@discovery
    desc: "测试环境-用户模块"
    config: 10.1.1.1 weight=1000;10.1.1.2 weight=10
    scheme: http
    type: round-robin

  - name: test-nacos
    driver: http_proxy
    desc: "测试环境-nacos"
    config: userService
    discovery: nacos_1@discovery
    scheme: http
    type: round-robin

discovery:
  -
    name: nacos_1
    driver: nacos
    labels:
      scheme: http
    config:
      address:
        - 127.0.0.1:8080
        - 10.1.1.1:8080
      params:
        username: xxx
        password: xxx
    health:
      protocol: http
      method: GET
      url: xxx
      success_code: 200
      timeout: 3000
      period: 30
    health_on: true
  -
    name: static_1
    driver: static
    labels:
      scheme: http
    health:
      protocol: http
      method: GET
      url: xxx
      success_code: 200
      timeout: 3000
      period: 30
    health_on: true

auth:
  -
    name: basic_1
    driver: basic
    user:
      -
        username: admin1
        password: 123456
        labels:
          name: test1
          remark: 测试人员1
        expire: 0
      -
        username: admin2
        password: 123456
        labels:
          name: test2
          remark: 测试人员2
        expire: 0
      -
        username: admin3
        password: 123456
        labels:
          name: test3
          remark: 测试人员3
        expire: 0
  -
    name: ak/sk_1
    driver: aksk
    user:
      -
        ak: admin1
        sk: 123456
        labels:
          name: test1
          remark: 测试人员1
        expire: 0
      -
        ak: admin1
        sk: 123456
        labels:
          name: test2
          remark: 测试人员2
        expire: 0
      -
        ak: admin1
        sk: 123456
        labels:
          name: test3
          remark: 测试人员3
        expire: 0
  -
    name: apikey_1
    driver: apikey
    user:
      -
        apikey: asdqer
        labels:
          name: test1
          remark: 测试人员1
        expire: 0
      -
        apikey: asdqer
        labels:
          name: test2
          remark: 测试人员2
        expire: 0
      -
        apikey: asdqer
        labels:
          name: test3
          remark: 测试人员3
        expire: 0

  -
    name: jwt_1
    driver: jwt
    credentials:
      -
        iss: goku
        secret: goku
        rsa_public_key: "-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEEVs/o5+uQbTjL3chynL4wXgUg2R9\nq9UU8I5mEovUf86QZ7kOBIjJwqnzD1omageEHWwHdBO6B+dFabmdT9POxg==\n-----END PUBLIC KEY-----"
        algorithm: HS256
    signature_is_base64: false
    claims_to_verify:
      - exp
      - nbf
    run_on_preflight: false
    hide_credentials: false